[tox]
envlist = test, lint, coverage

[testenv]
description = Run unit tests
deps =
    pytest
    pytest-cov
    pyyaml
    jsonschema
commands =
    pytest aib/tests -v --cov=aib --cov-report=html {tty:--color=yes} {posargs:tests}

[testenv:lint]
description = Run code linters
skip_install = true
deps =
    flake8
    black
commands =
    flake8 aib
    # TODO: uncomment after format is fixed
    # black --check aib

[testenv:coverage]
description = Check coverage
deps =
    coverage
skip_install = true
commands =
    # TODO: increase the current coverage
    coverage report --fail-under=49

[flake8]
# Ignore errors in current code to make the build pass
# TODO: fix the code and eliminate these ignores:
# E231  missing whitespace after ','
# E241  multiple spaces after ','
# E251  unexpected spaces around keyword / parameter equals
# E261  at least two spaces before inline comment
# E275  missing whitespace after keyword
# E302  expected 2 blank lines, found 1
# E303  too many blank lines (2)
# E305  expected 2 blank lines after class or function definition, found 1
# E501  line too long (xx > 79 characters)
# E711  comparison to None should be 'if cond is not None:'
# E713  test for membership should be 'not in'
#
# W504  line break after binary operator
#
# F401  'xxx' imported but unused
# F821  undefined name 'DefineFileError'
ignore = E231, E241, E251, E261, E711, E275, E302, E303, E305, E501, E713, W504, F401, F821
exclude = tests
