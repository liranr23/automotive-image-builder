default:
  image: quay.io/centos-sig-automotive/automotive-osbuild

stages:
  - test

compose-test-job:
  stage: test
  script:
    - tests/test-compose tests/test-compose.json

#compose-test-modified-distro-target:
#  stage: test
#  script:
#    - 'tests/test-compose tests/test-compose.json "$(git diff --diff-filter=d --name-only ${CI_MERGE_REQUEST_DIFF_BASE_SHA} | grep ^distro/ | xargs -r basename -s .ipp.yml)" "$(git diff --diff-filter=d --name-only ${CI_MERGE_REQUEST_DIFF_BASE_SHA} | grep ^targets/ | xargs -r basename -s .ipp.yml)"'
#  rules:
#    - changes:
#        - targets/*.ipp.yml
#        - distro/*.ipp.yml

unit-test-job:
  image: python:latest
  before_script:
    - python3 --version; pip --version
    - python3 -m pip install --upgrade pip
    - python3 -m pip install pytest
  stage: test
  script:
    - pytest aib/tests

yamllint-job:
  image: python:latest
  before_script:
    - python3 --version; pip --version
    - python3 -m pip install --upgrade pip
    - python3 -m pip install yamllint
  stage: test
  script:
    - make yamllint
